import torch
from models.experimental.functional_petr.reference.petr import PETR

inputs = torch.load("models/experimental/functional_petr/reference/golden_input_inputs_sample1.pt")
modified_batch_img_metas = torch.load(
    "models/experimental/functional_petr/reference/modified_input_batch_img_metas_sample1.pt"
)

model = PETR()

weights_state_dict = torch.load(
    "models/experimental/functional_petr/reference/petr_vovnet_gridmask_p4_800x320-e2191752.pth"
)["state_dict"]

model.load_state_dict(weights_state_dict)
model.eval()

output = model.predict(inputs, modified_batch_img_metas)

print("output", output)

# Output of torch reference
# [{'pts_bbox': {'bboxes_3d': <models.experimental.functional_petr.reference.utils.LiDARInstance3DBoxes object at 0x7f6ecf7a4b80>, 'scores_3d': tensor([0.9501, 0.9406, 0.8968, 0.8823, 0.8783, 0.8783, 0.8428, 0.7604, 0.7600,
#         0.7371, 0.7266, 0.6981, 0.6743, 0.6087, 0.5541, 0.5381, 0.4621, 0.4582,
#         0.4492, 0.4435, 0.4395, 0.4312, 0.4299, 0.4215, 0.4164, 0.4123, 0.4113,
#         0.4042, 0.4023, 0.4019, 0.3979, 0.3754, 0.3748, 0.3641, 0.3562, 0.3459,
#         0.3367, 0.3312, 0.3061, 0.3055, 0.3035, 0.3029, 0.3018, 0.3017, 0.2966,
#         0.2922, 0.2899, 0.2886, 0.2872, 0.2862, 0.2837, 0.2811, 0.2740, 0.2720,
#         0.2716, 0.2701, 0.2700, 0.2684, 0.2678, 0.2672, 0.2632, 0.2629, 0.2626,
#         0.2625, 0.2594, 0.2592, 0.2575, 0.2549, 0.2504, 0.2492, 0.2477, 0.2470,
#         0.2466, 0.2423, 0.2408, 0.2381, 0.2369, 0.2338, 0.2314, 0.2301, 0.2262,
#         0.2247, 0.2233, 0.2212, 0.2192, 0.2173, 0.2173, 0.2164, 0.2150, 0.2114,
#         0.2082, 0.2080, 0.2072, 0.2057, 0.2054, 0.2051, 0.2050, 0.2028, 0.2027,
#         0.1954, 0.1938, 0.1937, 0.1904, 0.1887, 0.1878, 0.1845, 0.1841, 0.1777,
#         0.1755, 0.1740, 0.1735, 0.1720, 0.1707, 0.1704, 0.1651, 0.1623, 0.1621,
#         0.1616, 0.1614, 0.1614, 0.1595, 0.1593, 0.1507, 0.1505, 0.1503, 0.1477,
#         0.1476, 0.1454, 0.1435, 0.1431, 0.1427, 0.1419, 0.1402, 0.1363, 0.1346,
#         0.1319, 0.1306, 0.1299, 0.1299, 0.1275, 0.1258, 0.1253, 0.1236, 0.1224,
#         0.1212, 0.1211, 0.1204, 0.1138, 0.1134, 0.1132, 0.1130, 0.1128, 0.1125,
#         0.1124, 0.1116, 0.1103, 0.1091, 0.1084, 0.1079, 0.1060, 0.1059, 0.1059,
#         0.1052, 0.1049, 0.1044, 0.1041, 0.1007, 0.0976, 0.0948, 0.0914, 0.0865,
#         0.0846, 0.0838, 0.0820, 0.0815, 0.0808, 0.0802, 0.0799, 0.0788, 0.0787,
#         0.0778, 0.0772, 0.0768, 0.0755, 0.0754, 0.0745, 0.0696, 0.0694, 0.0692,
#         0.0692, 0.0684, 0.0681, 0.0680, 0.0670, 0.0660, 0.0657, 0.0645, 0.0638,
#         0.0621, 0.0605, 0.0594, 0.0593, 0.0587, 0.0579, 0.0572, 0.0572, 0.0564,
#         0.0549, 0.0538, 0.0522, 0.0520, 0.0517, 0.0514, 0.0511, 0.0510, 0.0509,
#         0.0504, 0.0503, 0.0495, 0.0495, 0.0495, 0.0487, 0.0483, 0.0482, 0.0478,
#         0.0474, 0.0473, 0.0471, 0.0459, 0.0459, 0.0458, 0.0454, 0.0453, 0.0453,
#         0.0452, 0.0447, 0.0442, 0.0441, 0.0437, 0.0433, 0.0432, 0.0427, 0.0426,
#         0.0425, 0.0422, 0.0421, 0.0420, 0.0420, 0.0420, 0.0419, 0.0418, 0.0416,
#         0.0410, 0.0409, 0.0408, 0.0405, 0.0405, 0.0404, 0.0402, 0.0399, 0.0397,
#         0.0394, 0.0389, 0.0387, 0.0385, 0.0382, 0.0382, 0.0382, 0.0381, 0.0381,
#         0.0379, 0.0378, 0.0376, 0.0374, 0.0373, 0.0371, 0.0371, 0.0364, 0.0364,
#         0.0362, 0.0361, 0.0361, 0.0360, 0.0360, 0.0359, 0.0357, 0.0357, 0.0355,
#         0.0353, 0.0353, 0.0352, 0.0349, 0.0346, 0.0346, 0.0344, 0.0343, 0.0341,
#         0.0337, 0.0333, 0.0330], grad_fn=<IndexBackward0>), 'labels_3d': tensor([0, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 0, 8, 8, 8, 9, 0, 8, 8, 8, 8, 8, 8,
#         0, 0, 8, 0, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 6, 8, 8, 8, 8, 8, 0, 8, 8,
#         0, 8, 8, 8, 8, 7, 8, 8, 8, 8, 6, 0, 8, 8, 0, 7, 8, 7, 8, 8, 0, 8, 0, 3,
#         8, 8, 8, 8, 8, 9, 8, 8, 1, 6, 8, 9, 8, 0, 0, 8, 7, 9, 9, 8, 0, 8, 9, 7,
#         7, 8, 7, 0, 7, 7, 0, 8, 8, 0, 6, 7, 0, 9, 8, 8, 9, 0, 7, 7, 0, 7, 9, 7,
#         0, 6, 8, 0, 9, 8, 6, 7, 9, 1, 9, 6, 6, 9, 7, 8, 7, 7, 9, 7, 8, 6, 8, 8,
#         7, 9, 9, 9, 0, 7, 7, 7, 8, 0, 9, 1])}}]

# print("golden output",torch.load("/home/ubuntu/punith/tt-metal/models/experimental/functional_petr/reference/golden_output_results_list_3d_sample1.pt"))

# Original torch output
# golden output [{'pts_bbox': {'bboxes_3d': LiDARInstance3DBoxes(
#     tensor([[ 1.7059e-01, -2.0121e+01, -2.6828e+00,  ...,  1.5764e+00,
#          -1.3360e-02,  7.8525e+00],
#         [ 6.1065e+00, -1.1846e-01, -1.6143e+00,  ...,  1.5146e+00,
#          -8.7334e-05,  1.3843e+00],
#         [-3.2852e+00, -2.3924e+01, -2.8051e+00,  ..., -1.5951e+00,
#          -4.3367e-02, -9.5566e+00],
#         ...,
#         [-1.9120e+01,  1.8067e+01, -2.0013e+00,  ...,  8.3897e-02,
#          -2.6277e-05,  3.3398e-05],
#         [-9.8221e+00,  2.3653e+01, -1.1671e+00,  ...,  2.9832e+00,
#          -6.4630e-06, -4.1482e-06],
#         [ 7.1106e-02,  5.1200e+01,  2.3056e-01,  ..., -1.7137e+00,
#           6.3214e-06, -1.9662e-05]])), 'scores_3d': tensor([0.9501, 0.9406, 0.8968, 0.8823, 0.8783, 0.8783, 0.8428, 0.7604, 0.7600,
#         0.7371, 0.7266, 0.6981, 0.6743, 0.6087, 0.5541, 0.5381, 0.4621, 0.4582,
#         0.4492, 0.4435, 0.4395, 0.4312, 0.4299, 0.4215, 0.4164, 0.4122, 0.4113,
#         0.4042, 0.4023, 0.4019, 0.3979, 0.3754, 0.3748, 0.3641, 0.3562, 0.3459,
#         0.3367, 0.3312, 0.3061, 0.3055, 0.3035, 0.3029, 0.3018, 0.3017, 0.2966,
#         0.2922, 0.2899, 0.2886, 0.2872, 0.2862, 0.2837, 0.2811, 0.2740, 0.2720,
#         0.2716, 0.2701, 0.2700, 0.2684, 0.2678, 0.2672, 0.2632, 0.2629, 0.2626,
#         0.2625, 0.2594, 0.2592, 0.2575, 0.2549, 0.2504, 0.2492, 0.2478, 0.2470,
#         0.2466, 0.2423, 0.2408, 0.2381, 0.2369, 0.2338, 0.2314, 0.2301, 0.2262,
#         0.2247, 0.2233, 0.2212, 0.2192, 0.2173, 0.2173, 0.2164, 0.2150, 0.2114,
#         0.2082, 0.2080, 0.2072, 0.2057, 0.2054, 0.2051, 0.2050, 0.2028, 0.2027,
#         0.1954, 0.1938, 0.1937, 0.1904, 0.1887, 0.1878, 0.1845, 0.1841, 0.1777,
#         0.1755, 0.1740, 0.1735, 0.1720, 0.1707, 0.1704, 0.1651, 0.1623, 0.1621,
#         0.1616, 0.1614, 0.1614, 0.1595, 0.1593, 0.1507, 0.1505, 0.1503, 0.1477,
#         0.1476, 0.1454, 0.1435, 0.1431, 0.1427, 0.1419, 0.1402, 0.1363, 0.1346,
#         0.1319, 0.1306, 0.1299, 0.1299, 0.1275, 0.1258, 0.1253, 0.1236, 0.1224,
#         0.1212, 0.1211, 0.1204, 0.1138, 0.1134, 0.1132, 0.1130, 0.1128, 0.1125,
#         0.1124, 0.1116, 0.1103, 0.1091, 0.1084, 0.1079, 0.1060, 0.1059, 0.1059,
#         0.1052, 0.1049, 0.1044, 0.1041, 0.1007, 0.0976, 0.0948, 0.0914, 0.0865,
#         0.0846, 0.0838, 0.0820, 0.0815, 0.0808, 0.0802, 0.0799, 0.0788, 0.0787,
#         0.0778, 0.0772, 0.0768, 0.0755, 0.0754, 0.0745, 0.0696, 0.0694, 0.0692,
#         0.0692, 0.0684, 0.0681, 0.0680, 0.0670, 0.0660, 0.0657, 0.0645, 0.0638,
#         0.0621, 0.0605, 0.0594, 0.0593, 0.0587, 0.0579, 0.0572, 0.0572, 0.0564,
#         0.0549, 0.0538, 0.0522, 0.0520, 0.0517, 0.0514, 0.0511, 0.0510, 0.0509,
#         0.0504, 0.0503, 0.0495, 0.0495, 0.0495, 0.0487, 0.0483, 0.0482, 0.0478,
#         0.0474, 0.0473, 0.0471, 0.0459, 0.0459, 0.0458, 0.0454, 0.0453, 0.0453,
#         0.0451, 0.0447, 0.0442, 0.0441, 0.0437, 0.0433, 0.0432, 0.0427, 0.0426,
#         0.0425, 0.0422, 0.0421, 0.0420, 0.0420, 0.0420, 0.0419, 0.0418, 0.0416,
#         0.0410, 0.0409, 0.0408, 0.0405, 0.0405, 0.0404, 0.0402, 0.0399, 0.0397,
#         0.0394, 0.0389, 0.0387, 0.0385, 0.0382, 0.0382, 0.0382, 0.0381, 0.0381,
#         0.0379, 0.0378, 0.0376, 0.0374, 0.0373, 0.0371, 0.0371, 0.0364, 0.0364,
#         0.0362, 0.0361, 0.0361, 0.0360, 0.0360, 0.0359, 0.0357, 0.0357, 0.0355,
#         0.0353, 0.0353, 0.0352, 0.0349, 0.0346, 0.0346, 0.0344, 0.0343, 0.0341,
#         0.0337, 0.0333, 0.0330]), 'labels_3d': tensor([0, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8,
#         8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8,
#         8, 8, 8, 8, 8, 8, 8, 8, 0, 8, 8, 8, 0, 8, 8, 8, 9, 0, 8, 8, 8, 8, 8, 8,
#         0, 0, 8, 0, 8, 8, 8, 8, 0, 8, 8, 8, 8, 8, 8, 6, 8, 8, 8, 8, 8, 0, 8, 8,
#         0, 8, 8, 8, 8, 7, 8, 8, 8, 8, 6, 0, 8, 8, 0, 7, 8, 7, 8, 8, 0, 8, 0, 3,
#         8, 8, 8, 8, 8, 9, 8, 8, 1, 6, 8, 9, 8, 0, 0, 8, 7, 9, 9, 8, 0, 8, 9, 7,
#         7, 8, 7, 0, 7, 7, 0, 8, 8, 0, 6, 7, 0, 9, 8, 8, 9, 0, 7, 7, 0, 7, 9, 7,
#         0, 6, 8, 0, 9, 8, 6, 7, 9, 1, 9, 6, 6, 9, 7, 8, 7, 7, 9, 7, 8, 6, 8, 8,
#         7, 9, 9, 9, 0, 7, 7, 7, 8, 0, 9, 1])}}]
